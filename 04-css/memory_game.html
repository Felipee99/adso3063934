<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>12- memory game</title>
    <link rel="stylesheet" href="./css/style.css">
</head>

<body class="jquery">
    <main>
        <header class="header">
            <h1>Memory Game</h1>
            <h2>A simple memory game built with jQuery</h2>
        </header>
        <div id="stats">0 intentos</div>
        <div id="wrapper">
            <div id="game">
            </div>
        </div>
    </main>
    <script src="js/jquery-3.7.1.min.js"></script>
    <script src="js/jquery-3.7.1.min.js"></script>
<script>
    $(document).ready(function () {
        const totalCards = 12;
        let selectedCards = [];
        let currentMove = 0;
        let currentAttempt = 0;

        let cardTemplate = `<div class="card"><div class="back"></div><div class="face"></div></div>`;

        let valuesUsed = [];
        for (let i = 0; i < totalCards / 2; i++) {
            valuesUsed.push(i, i);
        }

        // Fisher-Yates Shuffle
        for (let i = valuesUsed.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [valuesUsed[i], valuesUsed[j]] = [valuesUsed[j], valuesUsed[i]];
        }

        function activateCard($card) {
            if (currentMove < 2 && !$card.hasClass("active")) {

                if (currentMove === 0) {
                    currentAttempt++;
                    $("#stats").text(currentAttempt + " intentos");
                }

                $card.addClass("active");

                if (!selectedCards[0] || selectedCards[0][0] !== $card[0]) {
                    selectedCards.push($card);
                    currentMove++;

                    if (currentMove === 2) {
                        const val1 = selectedCards[0].find(".face").html();
                        const val2 = selectedCards[1].find(".face").html();

                        if (val1 === val2) {
                            selectedCards = [];
                            currentMove = 0;

                            // ✅ Verificar si todas están activas
                            if ($(".card.active").length === totalCards) {
                                setTimeout(() => {
                                    reiniciarJuego();
                                }, 1000);
                            }

                        } else {
                            setTimeout(() => {
                                selectedCards[0].removeClass("active");
                                selectedCards[1].removeClass("active");
                                selectedCards = [];
                                currentMove = 0;
                            }, 600);
                        }
                    }
                }
            }
        }

        function crearCartas() {
            $("#game").empty();
            selectedCards = [];
            currentMove = 0;
            currentAttempt = 0;
            $("#stats").text("0 intentos");

            // Re-generar y mezclar valores
            valuesUsed = [];
            for (let i = 0; i < totalCards / 2; i++) {
                valuesUsed.push(i, i);
            }
            for (let i = valuesUsed.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [valuesUsed[i], valuesUsed[j]] = [valuesUsed[j], valuesUsed[i]];
            }

            for (let i = 0; i < totalCards; i++) {
                const $card = $(cardTemplate);
                $card.find(".face").html(`<img src="./img/${valuesUsed[i]}.png" alt="card" class="img-card">`);
                $card.on("click", function () {
                    activateCard($(this));
                });
                $("#game").append($card);
            }
        }

        function reiniciarJuego() {
            crearCartas();
        }

        crearCartas();
    });
</script>


</body>

</html>